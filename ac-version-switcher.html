<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Game Updates</title>
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #1e1e2f;
        color: #e0e0e0;
        padding: 20px;
    }
    h1 {
        color: #a259ff;
        text-align: center;
        margin-bottom: 20px;
    }
    .update, .hotfix {
        background-color: #2a2a3d;
        padding: 15px;
        margin-bottom: 15px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    .hotfix {
        background-color: #3a3a5d;
        margin-top: 10px;
    }
    ul {
        margin: 10px 0 10px 20px;
    }
    .date {
        font-size: 0.9em;
        color: #ccc;
    }
    .pagination {
        text-align: center;
        margin-top: 20px;
    }
    .pagination button {
        background-color: #a259ff;
        border: none;
        color: #fff;
        padding: 10px 15px;
        margin: 0 5px;
        border-radius: 5px;
        cursor: pointer;
    }
    .pagination button:disabled {
        background-color: #555;
        cursor: not-allowed;
    }
</style>
</head>
<body>
<h1>Game Updates</h1>

<div id="updates"></div>

<div class="pagination">
    <button id="prev">Previous</button>
    <span id="pageInfo"></span>
    <button id="next">Next</button>
</div>

<script>
const jsonURL = "https://wa1do.pythonanywhere.com/raw/wa1dowebsites/wa1do.pythonanywhere.com/refs/heads/main/game_data.json";
const updatesPerPage = 5;
let updatesArray = [];
let currentPage = 1;

async function fetchUpdates() {
    try {
        const res = await fetch(jsonURL);
        const data = await res.json();

        // Flatten all versions and hotfixes into a single array
        updatesArray = [];
        for (const verKey in data) {
            const ver = data[verKey];
            updatesArray.push({version: verKey, ...ver, isHotfix: false});
            if (ver.HOTFIX) {
                for (const hfKey in ver.HOTFIX) {
                    const hf = ver.HOTFIX[hfKey];
                    updatesArray.push({version: hfKey, ...hf, isHotfix: true});
                }
            }
        }

        renderPage();
    } catch (err) {
        document.getElementById('updates').innerHTML = "Failed to load updates.";
        console.error(err);
    }
}

function renderPage() {
    const start = (currentPage - 1) * updatesPerPage;
    const end = start + updatesPerPage;
    const pageUpdates = updatesArray.slice(start, end);

    const container = document.getElementById("updates");
    container.innerHTML = "";

    pageUpdates.forEach(upd => {
        const div = document.createElement("div");
        div.classList.add(upd.isHotfix ? "hotfix" : "update");
        div.innerHTML = `
            <h2>${upd.version} ${upd.isHotfix ? '(Hotfix)' : ''} - ${upd.NAME || ''}</h2>
            <p class="date">Date: ${upd.DATE}</p>
            <p>Binary ID: ${upd.BINARY_ID || ''} | Version Code: ${upd.VERSION_CODE || ''}</p>
            ${upd.FEATURES ? `<ul>${upd.FEATURES.map(f => `<li>${f}</li>`).join("")}</ul>` : ''}
        `;
        container.appendChild(div);
    });

    document.getElementById("pageInfo").textContent = `Page ${currentPage} of ${Math.ceil(updatesArray.length / updatesPerPage)}`;
    document.getElementById("prev").disabled = currentPage === 1;
    document.getElementById("next").disabled = currentPage === Math.ceil(updatesArray.length / updatesPerPage);
}

document.getElementById("prev").addEventListener("click", () => {
    if(currentPage > 1) currentPage--;
    renderPage();
});

document.getElementById("next").addEventListener("click", () => {
    if(currentPage < Math.ceil(updatesArray.length / updatesPerPage)) currentPage++;
    renderPage();
});

fetchUpdates();
</script>
</body>
</html>
